{
  "manifestVersion": "1",
  "name": "sponge-hook",
  "version": "1.0.0",
  "description": "Test hook for Hookstore/ABI: otxn_params + blobparts -> state",
  "publisher": "rNybLYJ4koM8PF3dJbyUZhrgYntGxf1nEk",
  "repo": "https://github.com/INFTF/sponge-hook",
  "license": "MIT",
  "networks": ["xahau-testnet"],

  "roles": {
    "installer": {
      "label": "Installer Account",
      "description": "Account that installs and invokes the hook"
    },
    "admin": {
      "label": "Admin Account",
      "description": "Account to be used for hp_admin"
    },
    "sender": {
      "label": "Sender Account",
      "description": "Account to be used for tp_sender"
    },
    "blobAccount": {
      "label": "Blob Account",
      "description": "Account to be used for blobAccount"
    }
  },

  "hooks": [
    {
      "id": "main",
      "artifact": {
        "toolchain": "hooks-c",
        "source_path": "src/sponge.c"
      },
      "HookOn": ["INVOKE"],
      "HookCanEmit": [],
      "HookNamespace": "0000000000000000000000000000000000000000000000000000000000000000",
      "abi": {
        "hookParameters": [
          {
            "name": "hp_admin",
            "selector": [
              {
                "type": "VarString",
                "pattern": "hp_admin",
                "byteLength": 8,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "AccountID",
                "byteLength": 20
              }
            ]
          },
          {
            "name": "hp_limit",
            "selector": [
              {
                "type": "VarString",
                "pattern": "hp_limit",
                "byteLength": 8,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "VarString"
              }
            ]
          },
          {
            "name": "hp_note",
            "selector": [
              {
                "type": "VarString",
                "pattern": "hp_note",
                "byteLength": 7,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "VarString"
              }
            ]
          }
        ],
        "otxnParameters": [
          {
            "name": "InvokeBlob",
            "description": "Blob data from Invoke transaction",
            "transactionTypes": [
              "Invoke"
            ],
            "selector": [
              {
                "type": "VarString",
                "pattern": "Blob",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "VarString",
                "pattern": "CONF",
                "byteLength": 4,
                "patternEncoding": "ascii"
              },
              {
                "type": "UInt8"
              },
              {
                "type": "AccountID",
                "byteLength": 20
              },
              {
                "type": "UInt64",
                "endianness": "BE",
                "byteLength": 8
              },
              {
                "type": "VarString"
              }
            ]
          },
          {
            "name": "tp_sender",
            "selector": [
              {
                "type": "VarString",
                "pattern": "tp_sender",
                "byteLength": 9,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "AccountID",
                "byteLength": 20
              }
            ],
            "transactionTypes": [
              "Invoke"
            ]
          },
          {
            "name": "tp_count",
            "selector": [
              {
                "type": "VarString",
                "pattern": "tp_count",
                "byteLength": 8,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "VarString"
              }
            ],
            "transactionTypes": [
              "Invoke"
            ]
          },
          {
            "name": "tp_label",
            "selector": [
              {
                "type": "VarString",
                "pattern": "tp_label",
                "byteLength": 8,
                "patternEncoding": "ascii",
                "exclude": true
              }
            ],
            "data": [
              {
                "type": "VarString"
              }
            ],
            "transactionTypes": [
              "Invoke"
            ]
          }
        ],
        "hookStates": [
          {
            "name": "tp_sender",
            "description": "State key: \"tp_sender\" (matches otxnParameter)",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 9,
                "label": "tp_sender",
                "pattern": "tp_sender",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "AccountID",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "tp_count",
            "description": "State key: \"tp_count\" (matches otxnParameter)",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 9,
                "label": "tp_count",
                "pattern": "tp_count",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "VarString",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "tp_label",
            "description": "State key: \"tp_label\" (matches otxnParameter)",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 9,
                "label": "tp_label",
                "pattern": "tp_label",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "VarString",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "blob_tag",
            "description": "State key: \"blob_tag\"",
            "notes": "Found state_set() with 8-byte key and 4-byte value at sponge.c:168. Key name: \"blob_tag\". Manual review required.",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 8,
                "label": "blob_tag",
                "pattern": "blob_tag",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "VarString",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "blob_version",
            "description": "State key: \"blob_version\"",
            "notes": "Found state_set() with 12-byte key and 1-byte value at sponge.c:174. Key name: \"blob_version\". Manual review required.",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 12,
                "label": "blob_version",
                "pattern": "blob_version",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "UInt8",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "blob_account",
            "description": "State key: \"blob_account\"",
            "notes": "Found state_set() with 12-byte key and 20-byte value at sponge.c:180. Key name: \"blob_account\". Manual review required.",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 12,
                "label": "blob_account",
                "pattern": "blob_account",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "AccountID",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "blob_limit",
            "description": "State key: \"blob_limit\"",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 10,
                "label": "blob_limit",
                "pattern": "blob_limit",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "UInt64",
                "label": "StateValue"
              }
            ]
          },
          {
            "name": "blob_note",
            "description": "State key: \"blob_note\"",
            "selector": [
              {
                "type": "Blob",
                "byteLength": 9,
                "label": "blob_note",
                "pattern": "blob_note",
                "patternEncoding": "ascii"
              }
            ],
            "data": [
              {
                "type": "VarString",
                "label": "StateValue",
                "notes": "Variable length value (determined at runtime)"
              }
            ]
          }
        ]
      },
      "HookParameters": [
        {
          "HookParameterName": "hp_admin",
          "HookParameterValue": {
            "type": "account",
            "value": "{{admin}}",
            "encoding": "hex"
          }
        },
        {
          "HookParameterName": "hp_limit",
          "HookParameterValue": {
            "type": "userConfig",
            "value": "{{hp_limit_value}}"
          }
        },
        {
          "HookParameterName": "hp_note",
          "HookParameterValue": {
            "type": "userConfig",
            "value": "{{hp_note_text}}"
          }
        }
      ],
      "postInstallSettings": [
        {
          "name": "Update TP parameters",
          "description": "Update tp_sender, tp_count, and tp_label via Invoke (otxn_param test)",
          "TransactionType": "Invoke",
          "HookParameters": [
            {
              "HookParameterName": "tp_sender",
              "HookParameterValue": {
                "type": "userConfig",
                "value": "{{newSender}}"
              }
            },
            {
              "HookParameterName": "tp_count",
              "HookParameterValue": {
                "type": "userConfig",
                "value": "{{newCount}}"
              }
            },
            {
              "HookParameterName": "tp_label",
              "HookParameterValue": {
                "type": "userConfig",
                "value": "{{newLabel}}"
              }
            }
          ],
          "userConfig": {
            "newSender": {
              "label": "New tp_sender Account",
              "inputType": "account",
              "encoding": "hex",
              "default": "rNybLYJ4koM8PF3dJbyUZhrgYntGxf1nEk",
              "description": "New account to store in tp_sender state (AccountID).",
              "required": true
            },
            "newCount": {
              "label": "New tp_count Value",
              "inputType": "string",
              "encoding": "utf8",
              "default": "100",
              "description": "New numeric value for tp_count (ascii).",
              "required": true
            },
            "newLabel": {
              "label": "New tp_label Text",
              "inputType": "string",
              "encoding": "utf8",
              "default": "Updated label",
              "description": "New text for tp_label.",
              "required": true
            }
          }
        },
        {
          "name": "Update Blob Config",
          "description": "Update blob_tag/version/account/limit/note via Invoke Blob (blobparts test)",
          "TransactionType": "Invoke",
          "Blob": [
            {
              "type": "ascii",
              "value": "CONF"
            },
            {
              "type": "userConfig",
              "value": "{{blobVersion}}"
            },
            {
              "type": "userConfig",
              "value": "{{newBlobAccount}}"
            },
            {
              "type": "userConfig",
              "value": "{{newBlobLimit}}"
            },
            {
              "type": "userConfig",
              "value": "{{newBlobNote}}"
            }
          ],
          "userConfig": {
            "blobVersion": {
              "label": "Blob Version",
              "inputType": "uint8",
              "encoding": "uint8",
              "default": "1",
              "description": "Single-byte version in Blob.",
              "required": true
            },
            "newBlobAccount": {
              "label": "Blob Account",
              "inputType": "account",
              "encoding": "hex",
              "default": "rNybLYJ4koM8PF3dJbyUZhrgYntGxf1nEk",
              "description": "Account embedded in Blob (stored in blob_account).",
              "required": true
            },
            "newBlobLimit": {
              "label": "Blob Limit (drops)",
              "inputType": "uint64",
              "encoding": "uint64",
              "endianness": "BE",
              "default": "1000000",
              "description": "Big-endian uint64 stored in blob_limit.",
              "required": true
            },
            "newBlobNote": {
              "label": "Blob Note",
              "inputType": "string",
              "encoding": "utf8",
              "default": "Updated blob note",
              "description": "Trailing text stored in blob_note.",
              "required": false
            }
          }
        }
      ]
    }
  ],

  "userConfig": {
    "hp_limit_value": {
      "label": "Limit (ascii)",
      "inputType": "string",
      "encoding": "utf8",
      "default": "1000000",
      "description": "Limit value for hp_limit, stored as ascii string.",
      "required": true
    },
    "hp_note_text": {
      "label": "Note (ascii/utf8)",
      "inputType": "string",
      "encoding": "utf8",
      "default": "Param sponge test",
      "description": "Note text for hp_note.",
      "required": true
    },
    "tp_count_value": {
      "label": "tp_count Value",
      "inputType": "string",
      "encoding": "utf8",
      "default": "42",
      "description": "Numeric value passed as tp_count (ascii).",
      "required": true
    },
    "tp_label_text": {
      "label": "tp_label Text",
      "inputType": "string",
      "encoding": "utf8",
      "default": "Hello ABI",
      "description": "Text passed as tp_label.",
      "required": true
    },
    "blobLimit": {
      "label": "Blob Limit (drops)",
      "inputType": "uint64",
      "encoding": "uint64",
      "endianness": "BE",
      "default": "1000000",
      "description": "Big-endian uint64 limit inside Blob.",
      "required": true
    },
    "blobNote": {
      "label": "Blob Note",
      "inputType": "string",
      "encoding": "utf8",
      "default": "Hello from blob",
      "description": "Trailing note text inside Blob.",
      "required": true
    }
  },

  "install": [
    {
      "TransactionType": "SetHook",
      "description": "Install param_sponge_blob hook",
      "required": true,
      "role": "installer",
      "hookIds": ["main"]
    },
    {
      "TransactionType": "Invoke",
      "description": "Invoke hook with otxn_params + structured Blob",
      "required": true,
      "role": "installer",

      "HookParameters": [
        {
          "HookParameterName": "tp_sender",
          "HookParameterValue": {
            "type": "account",
            "value": "{{sender}}",
            "encoding": "hex"
          }
        },
        {
          "HookParameterName": "tp_count",
          "HookParameterValue": {
            "type": "userConfig",
            "value": "{{tp_count_value}}"
          }
        },
        {
          "HookParameterName": "tp_label",
          "HookParameterValue": {
            "type": "userConfig",
            "value": "{{tp_label_text}}"
          }
        }
      ],

      "Blob": [
        {
          "type": "ascii",
          "value": "CONF"
        },
        {
          "type": "uint8",
          "value": 1
        },
        {
          "type": "account",
          "value": "{{blobAccount}}",
          "encoding": "hex"
        },
        {
          "type": "userConfig",
          "value": "{{blobLimit}}"
        },
        {
          "type": "userConfig",
          "value": "{{blobNote}}"
        }
      ]
    }
  ]
}
